<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCdigger - Ultimate Tool</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- DESIGN VARIABLES --- */
        :root {
            --bg-body: #050505;
            --bg-nav: #0f0f0f;
            --bg-card: #141414;
            --bg-input: #0a0a0a;
            --bg-code: #1e1e1e;
            --text-main: #e5e5e5;
            --text-dim: #888888;
            --border: #2a2a2a;
            --accent: #dc2626;
            --accent-dark: #7f1d1d;
            --accent-glow: rgba(220, 38, 38, 0.25);
            --success: #10b981;
            --font-ui: 'Segoe UI', Inter, system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Consolas', monospace;
            
            --beta: #f59e0b;
            --beta-bg: rgba(245, 158, 11, 0.1);
        }

        html.light {
            --bg-body: #f0f2f5;
            --bg-nav: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #f8f9fa;
            --bg-code: #2d2d2d;
            --text-main: #1f2937;
            --text-dim: #6b7280;
            --border: #e5e7eb;
            --accent: #ef4444;
            --accent-dark: #b91c1c;
            --accent-glow: rgba(239, 68, 68, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.2s, border-color 0.2s; }
        
        body {
            font-family: var(--font-ui);
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- NAVBAR --- */
        nav {
            height: 64px;
            background: var(--bg-nav);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
            flex-shrink: 0;
        }

        .brand {
            font-weight: 900;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            color: var(--text-main);
            user-select: none;
        }
        .brand span { color: var(--accent); }
        .brand svg { width: 28px; height: 28px; fill: var(--accent); transition: transform 0.3s ease; }
        .brand:hover svg { transform: rotate(15deg) scale(1.1); }

        .controls { display: flex; gap: 8px; }

        .btn-icon {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-main);
            min-width: 36px;
            height: 36px;
            padding: 0 10px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            position: relative;
        }
        .btn-icon:hover { border-color: var(--accent); color: var(--accent); }
        .btn-icon svg { width: 18px; height: 18px; fill: currentColor; }

        /* --- MAIN LAYOUT --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
            scroll-behavior: smooth;
        }

        .view { display: none; animation: fade 0.3s ease; max-width: 1300px; margin: 0 auto; }
        .view.active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD --- */
        .hero { text-align: center; margin-bottom: 3rem; }
        .hero h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        .hero p { color: var(--text-dim); text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px; }

        /* Main AI Box */
        .ai-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 6px;
            max-width: 700px;
            margin: 0 auto 3rem auto;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
            position: relative;
        }
        .ai-input-group { display: flex; }
        .ai-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 16px;
            color: var(--text-main);
            font-size: 1rem;
            outline: none;
        }
        .ai-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        .ai-btn:hover { background: var(--accent-dark); }

        .ai-output {
            padding: 16px;
            border-top: 1px solid var(--border);
            color: var(--text-dim);
            font-size: 0.9rem;
            line-height: 1.6;
            display: none;
            max-height: 500px; /* Max-Höhe beibehalten */
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
        }
        
        /* Tool Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            padding-bottom: 40px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }
        .card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 12px 24px var(--accent-glow);
        }
        .card.locked { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .card.locked:hover { transform: none; border-color: var(--border); box-shadow: none; }

        .card-icon {
            width: 48px; height: 48px;
            background: var(--bg-body);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--border);
        }
        .card:hover .card-icon { border-color: var(--accent); }
        .card-icon svg { width: 24px; height: 24px; fill: var(--text-main); }
        
        .card h3 { font-size: 1.1rem; font-weight: 700; margin: 0; }
        .card p { font-size: 0.85rem; color: var(--text-dim); line-height: 1.4; margin: 0; }

        .badges { display: flex; gap: 5px; position: absolute; top: 20px; right: 20px; }
        .badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; text-transform: uppercase; border: 1px solid; }
        .b-beta { border-color: var(--beta); color: var(--beta); background: var(--beta-bg); }
        .b-soon { border-color: #444; color: #888; background: #222; }

        .version-tag { position: absolute; bottom: 15px; right: 15px; font-size: 0.7rem; color: var(--text-dim); font-family: var(--font-mono); opacity: 0.6; }

        /* --- TOOL VIEW --- */
        .tool-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 24px;
            min-height: 500px;
            height: calc(100vh - 160px);
        }

        .tool-sidebar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
        }

        .tool-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
            position: relative;
        }

        .tool-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-nav);
        }
        .tool-header h2 { font-size: 1.2rem; font-weight: 700; }
        .tool-header svg { width: 24px; height: 24px; fill: var(--accent); }

        /* Output Area - Max Höhe und Scrollen standardmäßig erlaubt */
        .output-area {
            flex: 1;
            padding: 24px;
            max-height: 500px; /* Max-Höhe beibehalten */
            overflow-y: auto;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-dim);
            white-space: pre-wrap;
            position: relative;
        }
        
        /* Loading State - Entfernt Max-Höhe/Padding, Zentrierung und Scroll-Sperre */
        .output-area.loading {
            padding: 0;
            overflow-y: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            max-height: none; 
        }

        
        /* Loading Steps */
        .loading-container {
            padding: 20px;
            color: var(--text-dim);
            background: var(--bg-nav); 
            border: 1px solid var(--accent-dark);
            border-radius: 8px;
            box-shadow: 0 0 15px var(--accent-glow);
            min-width: 320px;
            max-width: 90%;
            margin: auto;
        }
        .loading-container > p { margin-bottom: 5px !important; } 

        .loading-step {
            display: flex;
            align-items: center;
            font-size: 0.95rem;
            margin-bottom: 2px; 
            white-space: nowrap; 
        }
        .loading-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .loading-step.active .loading-icon .loading-pulse {
            display: inline-block;
            width: 10px; height: 10px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 1s infinite;
        }
        .loading-step.active span { color: var(--accent); }

        @keyframes pulse { 0% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.3; transform: scale(0.8); } }

        /* Form Elements */
        label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--text-dim); text-transform: uppercase; margin-bottom: 6px; }
        .inp, .sel, .txt-area {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 12px;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }
        .txt-area { resize: vertical; min-height: 120px; }
        .inp:focus, .sel:focus, .txt-area:focus { outline: none; border-color: var(--accent); }
        
        .chk-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .chk-label { 
            display: flex; align-items: center; gap: 5px; font-size: 0.8rem; cursor: pointer; 
            background: var(--bg-input); padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border);
        }
        .chk-label:has(input:checked) { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

        .btn-full {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-full:hover { background: var(--accent-dark); }
        .btn-disabled { background: #333; color: #666; cursor: not-allowed; }
        .btn-disabled:hover { background: #333; }

        /* Markdown & Code Styling */
        .markdown-body { line-height: 1.6; }
        .markdown-body h3 { color: var(--text-main); margin-top: 1rem; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .markdown-body strong { color: var(--accent); }
        .markdown-body p { margin-bottom: 10px; }
        .markdown-body ul { padding-left: 20px; margin-bottom: 10px; }
        
        pre {
            background: var(--bg-code);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border);
            overflow-x: auto;
            position: relative;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        code { font-family: var(--font-mono); color: #fca5a5; }
        
        /* Copy Button for Code Blocks - GEÄNDERT auf sticky */
        .copy-btn {
            position: sticky; 
            top: 5px; 
            right: 5px;
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            color: var(--text-dim);
            font-size: 0.7rem; 
            padding: 4px 8px; 
            border-radius: 4px; 
            cursor: pointer;
            opacity: 0.7; 
            transition: opacity 0.2s;
            z-index: 50; 
        }
        .copy-btn:hover { opacity: 1; color: var(--accent); border-color: var(--accent); }

        /* Gradient Builder Tools */
        .grad-list { display: flex; flex-direction: column; gap: 8px; }
        .grad-row { display: flex; gap: 5px; align-items: center; }
        .color-preview { width: 40px; height: 38px; border: none; padding: 0; background: none; cursor: pointer; }
        .btn-sec { background: transparent; border: 1px dashed var(--border); color: var(--text-dim); padding: 8px; width: 100%; border-radius: 6px; cursor: pointer; margin-top: 5px;}
        .btn-sec:hover { border-color: var(--text-main); color: var(--text-main); }
        .btn-del { cursor: pointer; color: var(--text-dim); padding: 5px; }
        .btn-del:hover { color: var(--accent); }

        /* Error Display */
        #js-error-display {
            position: fixed; bottom: 20px; right: 20px; left: auto; width: 300px;
            background: #7f1d1d; color: white; padding: 15px; border-radius: 8px;
            font-family: monospace; z-index: 9999; font-size: 0.8rem;
            display: none; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 900px) {
            .tool-container { grid-template-columns: 1fr; height: auto; }
            .tool-sidebar { order: 2; }
            .tool-content { order: 1; min-height: 400px; }
        }
    </style>
</head>
<body>

    <div id="js-error-display"></div>

    <nav>
        <div class="brand" onclick="app.home()">
            <svg viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 3.45l.55.95h-1.1L12 5.45zM10 19H8v-2h2v2zm6 0h-2v-2h2v2z"/></svg>
            MC<span>DIGGER</span>
        </div>
        <div class="controls">
            <div class="btn-icon" id="backBtn" onclick="app.home()" style="display:none;">
                <span id="lblBack">Zurück</span>
            </div>
            <div class="btn-icon" onclick="app.toggleLang()" id="langIcon">DE</div>
            <div class="btn-icon" onclick="app.toggleTheme()" id="themeIcon">
                <svg viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.41 1.41c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.41 1.41c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.41-1.41zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.41-1.41zM7.05 18.36c.39-.39.39-1.02 0-1.41a.996.996 0 00-1.41 0l-1.41 1.41c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0l1.41-1.41z"/></svg>
            </div>
        </div>
    </nav>

    <main>
        <div id="view-home" class="view active">
            <div class="hero">
                <h1>MC<span style="color:var(--accent)">DIGGER</span></h1>
                <p>HYBRID ENGINE: AI & LOCAL</p>
            </div>

            <div class="ai-box">
                <div class="ai-input-group">
                    <input type="text" id="mainAiPrompt" class="ai-input" placeholder="Frag die MCdigger AI (z.B. Crafting Rezept)...">
                    <button class="ai-btn" onclick="app.askMain()">GO</button>
                </div>
                <div id="mainAiRes" class="ai-output"></div>
            </div>

            <div class="grid" id="toolsGrid">
                <p style="padding:20px; color:#666;">Lade Tools...</p>
            </div>
        </div>

        <div id="view-tool" class="view">
            <div class="tool-container">
                <div class="tool-sidebar" id="toolSidebar"></div>
                <div class="tool-content">
                    <div class="tool-header">
                        <div id="toolIconHeader"></div>
                        <h2 id="toolTitleHeader">Tool</h2>
                    </div>
                    <div class="output-area markdown-body" id="toolOutput">Warte auf Eingabe...</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // CONFIG
        const CONFIG = {
            // DEIN API Key, bereitgestellt von peroonic
            apiKey: 'AIzaSyCJ1IdHYxE9_snBTh9yuMFKhvXinlLbC7M'
        };

        window.onerror = function(msg, url, line, col, error) {
            const el = document.getElementById('js-error-display');
            el.style.display = 'block';
            el.innerText = `System Error: ${msg}`;
            setTimeout(() => el.style.display = 'none', 5000);
            return false;
        };

        // KORRIGIERTE ANWEISUNG: Der Code MUSS funktional und präzise sein.
        const getLangInstruction = (lang) => {
            // VERBESSERT: Konkreter Fokus auf Hardcap, Attribute und Components.
            if (lang === 'de') return "Antworte auf Deutsch. Erkläre es kurz, präzise und professionell. Der ausgegebene Code/Befehl MUSS 100%ig FUNKTIONAL und AKKURAT sein. Nutze die offizielle Minecraft Dokumentation (z.B. Minecraft Wiki) zur Überprüfung der Syntax für Attribute Modifiers und Komponenten. Wenn ein Wert (z.B. ein Enchantment Level wie 2.000.000) die In-Game-Grenze überschreitet, MUSS der Befehl automatisch den HÖCHSTEN FUNKTIONALEN Wert (z.B. 255 oder das Hardcap) verwenden und dies kurz erwähnen. Achte strikt auf die korrekte NBT/Component-Syntax der angegebenen Version. Gib nur den finalen, lauffähigen Befehl aus, oder sage, wenn die Anforderung technisch nicht umsetzbar ist.";
            return "Answer in English. Explain concisely and professionally. The output code/command MUST be 100% FUNCTIONAL and ACCURATE. Use the official Minecraft documentation (e.g., Minecraft Wiki) to verify syntax for Attribute Modifiers and Components. If a value (e.g., an enchantment level like 2,000,000) exceeds the in-game limit, the command MUST automatically use the HIGHEST FUNCTIONAL value (e.g., 255 or the hardcap) and briefly mention this. Pay strict attention to the correct NBT/Component syntax for the specified version. Output only the final, runnable command, or state if the requirement is technically unfeasible.";
        };

        // EXTREM ERWEITERTE VERSIONSLISTE
        const generateVersionOptions = () => {
            const versions = [
                // 1.21 (Tricky Trials)
                '1.21.8', '1.21.7', '1.21.6', '1.21.5', '1.21.4', '1.21.3', '1.21.2', '1.21.1', '1.21',
                // 1.20 (Trails & Tales)
                '1.20.6', '1.20.5', '1.20.4', '1.20.3', '1.20.2', '1.20.1', '1.20',
                // 1.19 (The Wild Update)
                '1.19.4', '1.19.3', '1.19.2', '1.19.1', '1.19',
                // 1.18 (Caves & Cliffs: Part II)
                '1.18.2', '1.18.1', '1.18',
                // 1.17 (Caves & Cliffs: Part I)
                '1.17.1', '1.17',
                // 1.16 (Nether Update)
                '1.16.5', '1.16.4', '1.16.3', '1.16.2', '1.16.1', '1.16',
                // 1.15 (Buzzy Bees)
                '1.15.2', '1.15.1', '1.15',
                // 1.14 (Village & Pillage)
                '1.14.4', '1.14.3', '1.14.2', '1.14.1', '1.14',
                // 1.13 (Update Aquatic)
                '1.13.2', '1.13.1', '1.13',
                // 1.12 (World of Color)
                '1.12.2', '1.12.1', '1.12',
                // 1.11 (Exploration Update)
                '1.11.2', '1.11.1', '1.11',
                // 1.10 (Frostburn Update)
                '1.10.2', '1.10.1', '1.10',
                // 1.9 (Combat Update)
                '1.9.4', '1.9.3', '1.9.2', '1.9.1', '1.9',
                // 1.8 (Bountiful Update)
                '1.8.9', '1.8.8', '1.8.7', '1.8.6', '1.8.5', '1.8.4', '1.8.3', '1.8.2', '1.8.1', '1.8'
            ];
            return versions;
        };
        
        const FULL_VERSIONS = generateVersionOptions();
        const COMPONENT_VERSIONS = ['1.21.x (Components)', '1.20.5+ (Components)'];
        const NBT_VERSIONS = ['1.20.4- (NBT)'];


        const TRANSLATIONS = {
            de: {
                back: "Zurück",
                ph_ai: "Frag die MCdigger AI (z.B. Crafting Rezept)...",
                gen_btn: "GENERIEREN",
                calc_btn: "BERECHNEN",
                loading: "Hybrid Engine arbeitet...",
                step1: "Verbindung zu MCdigger AI herstellen", 
                step2: "Command generieren (Experten-Modus)",
                step3: "Syntax auf Version {ver} prüfen (100% Garantie)",
                // Neue/Aktualisierte Keys
                t_spawner: "Erstellt Mob Spawner mit Items, Effekten und spezifischen Mobs.",
                s_mob: "Mob Typ (z.B. zombie)",
                s_delay: "Min/Max Delay (Ticks)",
                s_count: "Anzahl Mobs pro Spawn",
                fmt_bold: "Fett",
                fmt_italic: "Kursiv",
                fmt_under: "Unterstrichen",
                fmt_strike: "Durchgestrichen",
                fmt_obf: "Verschleiert",
                book_hover: "Hover Text",
                invul: "Unverwundbar", 
                // Tools
                t_nether: "Berechnet Koordinaten zwischen Overworld/Nether sofort.",
                t_datapack: "Erstellt Advancements, Loot Tables & Functions in einem kompletten Data Pack.", // NEU
                t_potion: "Erstellt OP-Tränke (beachtet die neue 1.20.5+ Syntax).",
                t_fire: "Für komplexe Raketen mit Farben/Fades.",
                t_book: "Erstellt JSON-Bücher/Schilder mit Klick-Events.",
                t_tell: "Für bunte Chat-Nachrichten an Spieler.",
                t_yaml: "Findet und repariert Config-Fehler.",
                t_part: "Erstellt Commands für Partikel-Kreise/Herzen.",
                t_prop: "Optimiert server.properties für Performance.",
                t_spigot: "Paper/Spigot Config: Jetzt mit modernen Optionen.",
                t_motd: "MOTD Creator: Verbessert für Hex-Farben Support.",
                t_ban: "Banner Maker: Präzise Crafting-Schritte.",
                t_lore: "Lore Writer: Jetzt mit 'Stil'-Auswahl.",
                t_plug: "Plugin Picker: Filtert veraltete Plugins besser.",
                t_skin: "Skin & Name: Kreativere Namensvorschläge.",
                t_log: "Log Detector: Analysiert Fehler und Crashes.",
                t_armor: "Armor Stand Editor 2.0: Kopf, Slots, Flags, etc.",
                t_jar: "Plugin Compiler: Coming Soon (Beta).",
                t_cmd: "Command Gen: Verbesserte Prompts (Beta).",
                t_menu: "Menu Generator: Für DeluxeMenus & ZMenu.",
                t_grad: "Gradient Text (Birdflop Style).",
                t_head: "Head Generator: Sofort /give für Köpfe.",
                t_stack: "Stack Rechner: Items in Shulker/Stacks umrechnen.",
            },
            en: {
                back: "Back",
                ph_ai: "Ask MCdigger AI (Minecraft only)...",
                gen_btn: "GENERATE",
                calc_btn: "CALCULATE",
                loading: "Hybrid Engine working...",
                step1: "Establishing connection to MCdigger AI", 
                step2: "Generating command (Expert Mode)",
                step3: "Checking syntax for version {ver} (100% guarantee)",
                // New/Updated Keys
                t_spawner: "Creates mob spawners with items, effects and specific mobs.",
                s_mob: "Mob Type (e.g. zombie)",
                s_delay: "Min/Max Delay (Ticks)",
                s_count: "Mobs per Spawn",
                fmt_bold: "Bold",
                fmt_italic: "Italic",
                fmt_under: "Underlined",
                fmt_strike: "Strikethrough",
                fmt_obf: "Obfuscated",
                book_hover: "Hover Text",
                invul: "Invulnerable", 
                // Tools
                t_nether: "Calculates coords Overworld/Nether instantly.",
                t_datapack: "Creates advancements, loot tables & functions in a complete data pack.", // NEU
                t_potion: "Creates OP potions (supports 1.20.5+ syntax).",
                t_fire: "For complex rockets with colors/fades.",
                t_book: "Creates JSON books/signs with click events.",
                t_tell: "For colorful chat messages to players.",
                t_yaml: "Finds and fixes config errors.",
                t_part: "Creates commands for particle circles/hearts.",
                t_prop: "Optimizes server.properties for performance.",
                t_spigot: "Paper/Spigot Config: Now with modern options.",
                t_motd: "MOTD Creator: Improved Hex color support.",
                t_ban: "Banner Maker: More precise crafting steps.",
                t_lore: "Lore Writer: Now with 'Style' selection.",
                t_plug: "Plugin Picker: Filters outdated plugins better.",
                t_skin: "Skin & Name: More creative name suggestions.",
                t_log: "Log Detector: Analyzes errors and crashes.",
                t_armor: "Armor Stand Editor 2.0: Head, slots, flags, etc.",
                t_jar: "Plugin Compiler: Coming Soon (Beta).",
                t_cmd: "Command Gen: Improved Prompts (Beta).",
                t_menu: "Menu Generator: For DeluxeMenus & ZMenu.",
                t_grad: "Gradient Text (Birdflop Style).",
                t_head: "Head Generator: Instant /give for heads.",
                t_stack: "Stack Calculator: Convert items to Shulkers/Stacks.",
            }
        };

        const TOOLS = [
            // --- LOKALE TOOLS ---
            {
                id: 'nether', title: 'Nether Rechner', descKey: 't_nether', type: 'local', version: 'All',
                icon: '<path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 9h-2V7h-2v5H6v2h2v5h2v-5h2v-2z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'x', label: 'X', type: 'text', ph: '1000'}, 
                    {id: 'z', label: 'Z', type: 'text', ph: '1000'}, 
                    {id: 'mode', label: 'Mode', type: 'select', opts: ['Overworld->Nether', 'Nether->Overworld']}
                ]
            },
            {
                id: 'stack', title: 'Stack Rechner', descKey: 't_stack', type: 'local', version: 'All',
                icon: '<path d="M4 6h16v2H4zm2 4h12v2H6zm-2 4h16v2H4zm0 4h16v2H4z"/>', 
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'amt', label: 'Anzahl Items', type: 'text', ph: '2000'}, 
                    {id: 'size', label: 'Stack Größe', type: 'text', ph: '64'}
                ]
            },
            {
                id: 'head', title: 'Head Generator', descKey: 't_head', type: 'local', version: 'All',
                icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, 
                    {id: 'name', label: 'Name', type: 'text', ph: 'MHF_Herobrine'}, 
                    {id: 'target', label: 'Target', type: 'text', ph: '@p'}
                ]
            },
            
            // --- SPAWNER GENERATOR ---
            {
                id: 'spawner', title: 'Spawner Generator', descKey: 't_spawner', type: 'ai', version: 'All',
                icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>', 
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'mob', label: 'Mob Typ (z.B. zombie)', descKey: 's_mob', type: 'text', ph: 'skeleton'},
                    {id: 'delay', label: 'Min/Max Delay (Ticks)', descKey: 's_delay', type: 'text', ph: '10 / 600'},
                    {id: 'count', label: 'Anzahl Mobs pro Spawn', descKey: 's_count', type: 'text', ph: '4'},
                    {id: 'invul', label: 'Unverwundbar', type: 'checks', opts: ['Invulnerable']},
                    {id: 'equipment', label: 'Mob Ausrüstung/Effekte/Passagiere', type: 'textarea', ph: 'Z.B. Zombie mit Diamantschwert, Stärke 5, auf Huhn reitend. (Nutze natürliche Sprache)'}
                ],
                // Prompt aktualisiert, um Invulnerable einzubinden
                prompt: (d, l) => {
                    const invul = d.invul.includes('Invulnerable') ? 'Make the spawned mob Invulnerable (Invulnerable:1b).' : 'The mob should NOT be Invulnerable.';
                    return `Generate a /setblock command for a Mob Spawner in Minecraft Version ${d.ver} at ~ ~1 ~ (replace mode). Set the primary spawned entity to '${d.mob}'. Use the spawn parameters: Min/Max Delay: ${d.delay} ticks, Spawn Count: ${d.count}. The command MUST incorporate the complex entity data specified by the user: "${d.equipment}". ${invul} This includes nested entities (Passengers), custom NBT/Components for items (Name, Lore, Enchantments, Drop Chances), and entity flags (Silent, Active Effects). The command MUST be fully functional and complete, prioritizing complexity and accuracy based on the user's detailed request. Focus heavily on implementing the NBT/Components for the equipment accurately for version ${d.ver}.`;
                }
            },

            // --- NEUES DATA PACK CREATOR TOOL ---
            {
                id: 'datapack', title: 'Data Pack Creator', descKey: 't_datapack', type: 'ai', version: '1.20+',
                icon: '<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>', // Stern-Icon vom alten Adv. Creator
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'desc', label: 'Beschreibung (Advancements, Loot Tables, Functions...)', type: 'textarea', ph: 'Erstelle 3 Advancements: Tötung eines Zombies, Erreichen des Nethers. Eine Loot Table für das Schaf, die immer Wolle und 1 Diamanten dropt. Eine Function für /op-all.'}
                ],
                // PROMPT AKTUALISIERT: Generiert Data Pack Struktur + Tutorial + Struktur-Check
                prompt: (d, l) => {
                    // Mapping der Pack-Format-Version zur Minecraft-Version (basierend auf MC Wiki)
                    let packFormat;
                    const versionMap = {
                        '1.21': 48, '1.20.5': 48, '1.20': 26, '1.19': 10, '1.18': 9, '1.17': 7, '1.16': 6, '1.15': 5, '1.14': 4, '1.13': 4, '1.12': 3, '1.11': 3, '1.10': 3, '1.9': 3, '1.8': 1
                    };
                    for (const [v, format] of Object.entries(versionMap)) {
                        if (d.ver.startsWith(v)) {
                            packFormat = format;
                            break;
                        }
                    }
                    if (!packFormat) packFormat = 48; // Standard für neueste Version

                    return `Erzeuge eine VOLLSTÄNDIGE Minecraft Data Pack Struktur (Version ${d.ver}). Der Name des Data Packs soll "mcdigger_pack" sein. Verwende den Namespace "mcdigger". Die "pack_format" Version in pack.mcmeta muss ${packFormat} sein. Generiere die vollständigen JSON/MCFUNCTION-Dateien basierend auf dieser Beschreibung: "${d.desc}". **WICHTIG:** 1. Loot Tables müssen die korrekte Struktur mit "pools", "entries", "functions" und "conditions" verwenden (orientiert am Misode Loot Table Generator). 
2. Advancements müssen "display", "criteria" und "rewards" enthalten (orientiert am Misode Advancement Generator).
3. Für simple Quality-of-Life-Verbesserungen (wie benutzerdefinierte Rezepte oder Funktionen) generiere den notwendigen JSON/MCFUNCTION Code (orientiert an Vanilla Tweaks). 
4. Halte die Data Pack Ordnerstruktur strikt ein, d.h., alle Dateien müssen im Ordner **data/mcdigger/** abgelegt werden (außer pack.mcmeta).
Gib den Inhalt JEDER Datei in einem separaten Markdown-Codeblock aus, wobei der vollständige Dateipfad (z.B. mcdigger_pack/pack.mcmeta oder mcdigger_pack/data/mcdigger/advancements/root.json) direkt über dem Codeblock steht. Anschließend gib eine klare, strukturierte **SCHRITT-FÜR-SCHRITT ANLEITUNG AUF DEUTSCH** wie man das erzeugte Data Pack in eine Minecraft Java Welt (Singleplayer oder Server) einfügt und aktiviert.`;
                }
            },
            
            // --- DIE RESTLICHEN AI TOOLS ---
            {
                id: 'potion', title: 'Potion Brewer', descKey: 't_potion', type: 'ai', version: '1.20.5+',
                icon: '<path d="M16.5 11l-4.5-8-4.5 8v7h9v-7zM12 4.5l3 5.33V16h-6V9.83L12 4.5z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'eff', label: 'Effekte', type: 'text', ph: 'Speed 2, Strength 1'}, 
                    {id: 'type', label: 'Typ', type: 'select', opts: ['Drink', 'Splash', 'Lingering']}
                ],
                prompt: (d, l) => `Give command for a ${d.type} potion (MC Version ${d.ver}). Effects: ${d.eff}. IMPORTANT: Use 'potion_contents' and 'custom_effects' components properly for 1.20.5+ versions, otherwise use NBT Tag.`
            },
            {
                id: 'fire', title: 'Firework Architect', descKey: 't_fire', type: 'ai', version: 'All',
                icon: '<path d="M12 2l-2 6h4l-2-6zm-1 7v8h2V9h-2zm1 9c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'cols', label: 'Farben', type: 'text', ph: 'red, orange'}, 
                    {id: 'fade', label: 'Fade Farben', type: 'text', ph: 'yellow, white'}, 
                    {id: 'shape', label: 'Form', type: 'select', opts: ['Ball', 'Star', 'Burst', 'Creeper']}
                ],
                prompt: (d, l) => `Give firework rocket command (Version ${d.ver}, Duration 2). Explosion: Shape ${d.shape}, Colors [${d.cols}], Fade [${d.fade}].`
            },
            {
                id: 'book', title: 'Book & Sign', descKey: 't_book', type: 'ai', version: 'All',
                icon: '<path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'type', label: 'Objekt Typ', type: 'select', opts: ['Writable Book', 'Written Book', 'Hanging Sign', 'Standing Sign']}, 
                    {id: 'txt', label: 'Anzeige Text', type: 'text', ph: 'Click me!'}, 
                    {id: 'hover', label: 'Hover Text', descKey: 'book_hover', type: 'text', ph: 'Item/Text-Anzeige beim Hover'},
                    {id: 'click', label: 'Klick Befehl', type: 'text', ph: '/heal'}
                ],
                // Prompt aktualisiert, um Hover und neue Typen zu unterstützen
                prompt: (d, l) => `Generate /give command for a ${d.type} (Version ${d.ver}). Main Text: "${d.txt}". ClickEvent: Run Command '${d.click}'. Hover Text (if applicable): '${d.hover}'. Ensure correct JSON escaping and syntax for ${d.ver}. For 'Written Book', ensure it has title/author/pages tags/components.`
            },
            {
                id: 'tell', title: 'Tellraw Gen', descKey: 't_tell', type: 'ai', version: 'All',
                icon: '<path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'msg', label: 'Nachricht', type: 'text', ph: 'Welcome peroonic'}, 
                    {id: 'col', label: 'Farbe (Hex/Legacy)', type: 'text', ph: '#FFAA00'}, 
                    {id: 'style', label: 'Formatierung', type: 'checks', opts: [TRANSLATIONS.de.fmt_bold, TRANSLATIONS.de.fmt_italic, TRANSLATIONS.de.fmt_under, TRANSLATIONS.de.fmt_strike, TRANSLATIONS.de.fmt_obf]}, 
                    {id: 'tar', label: 'Empfänger', type: 'text', ph: '@a'}
                ],
                // Prompt aktualisiert, um Formatierung zu unterstützen
                prompt: (d, l) => {
                    const styles = d.style.split(', ').map(s => {
                        if (s === TRANSLATIONS.de.fmt_bold) return `"bold":true`;
                        if (s === TRANSLATIONS.de.fmt_italic) return `"italic":true`;
                        if (s === TRANSLATIONS.de.fmt_under) return `"underlined":true`;
                        if (s === TRANSLATIONS.de.fmt_strike) return `"strikethrough":true`;
                        if (s === TRANSLATIONS.de.fmt_obf) return `"obfuscated":true`;
                        return '';
                    }).filter(s => s).join(', ');
                    
                    const styleContent = styles ? `, ${styles}` : '';
                    return `Generate /tellraw command for Version ${d.ver}. Target: ${d.tar}. Content: [{"text":"${d.msg}", "color":"${d.col}"${styleContent}}]. Use appropriate color codes (Hex/Legacy) for the selected version.`;
                }
            },
            {
                id: 'yaml', title: 'YAML Fixer', descKey: 't_yaml', type: 'ai', version: 'All',
                icon: '<path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'yml', label: 'Config Code', type: 'textarea', ph: 'item:\n  id: dirt'}],
                prompt: (d, l) => `Analyze this YAML for syntax/indentation errors. Fix them and output the clean YAML code. Input:\n${d.yml}`
            },
            {
                id: 'part', title: 'Particle Shapes', descKey: 't_part', type: 'ai', version: 'All',
                icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'shape', label: 'Form', type: 'select', opts: ['Circle', 'Heart', 'Spiral']}, 
                    {id: 'part', label: 'Partikel', type: 'text', ph: 'flame'}
                ],
                prompt: (d, l) => `Generate a Repeating Command Block command for Minecraft Version ${d.ver}. Spawn particles '${d.part}' in a ${d.shape} shape relative to execution coordinates.`
            },
            {
                id: 'prop', title: 'Server Optimizer', descKey: 't_prop', type: 'ai', version: 'All',
                icon: '<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.488.488 0 00-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'ram', label: 'RAM (GB)', type: 'text', ph: '4'}, {id: 'pl', label: 'Players', type: 'text', ph: '30'}, {id: 'type', label: 'Type', type: 'select', opts: ['Survival', 'PVP']}],
                prompt: (d, l) => `Suggest key server.properties and spigot/paper settings for: ${d.ram} RAM, ${d.pl} players, gamemode ${d.type}. Focus on view-distance, simulation-distance, and entity-activation-range.`
            },
            {
                id: 'spigot', title: 'Paper/Spigot Config', descKey: 't_spigot', type: 'ai', version: '1.20+',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'file', label: 'Datei', type: 'select', opts: ['paper-global.yml', 'paper-world.yml', 'spigot.yml']}, {id: 'mode', label: 'Mode', type: 'select', opts: ['Performance', 'Gameplay']}],
                prompt: (d, l) => `Optimize ${d.file} for ${d.mode}. List the 5 most impactful changes for modern Paper 1.20+.`
            },
            {
                id: 'motd', title: 'MOTD Creator', descKey: 't_motd', type: 'ai', version: 'All',
                icon: '<path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'l1', label: 'Line 1', type: 'text'}, {id: 'l2', label: 'Line 2', type: 'text'}],
                prompt: (d, l) => `Create a server MOTD using legacy (§) and modern hex (&#) colors where appropriate. Line 1: ${d.l1}, Line 2: ${d.l2}. Output the raw string for server.properties.`
            },
            {
                id: 'ban', title: 'Banner Maker', descKey: 't_ban', type: 'ai', version: 'All',
                icon: '<path d="M12 2L2 7v10h20V7L12 2zm0 2.8L19.2 8H4.8L12 4.8zM12 20c-3.31 0-6-2.69-6-6h12c0 3.31-2.69 6-6 6z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'desc', label: 'Design', type: 'text', ph: 'Dragon'}
                ],
                prompt: (d, l) => `Provide step-by-step Banner crafting instructions for a design looking like: ${d.desc} (MC Version ${d.ver}). The 'BlockEntityTag' code for /give must be functional for ${d.ver}.`
            },
            {
                id: 'lore', title: 'Lore Writer', descKey: 't_lore', type: 'ai', version: 'All',
                icon: '<path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'item', label: 'Item', type: 'text', ph: 'Excalibur'}, {id: 'style', label: 'Style', type: 'select', opts: ['Mystic', 'Modern', 'Funny']}],
                prompt: (d, l) => `Write cool Item Lore for ${d.item}. Style: ${d.style}. Use color codes (§6, §a, etc.). Max 3 lines.`
            },
            {
                id: 'plug', title: 'Plugin Picker', descKey: 't_plug', type: 'ai', version: 'Plugins',
                icon: '<path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"/>',
                inputs: [{id: 'cat', label: 'Kategorie', type: 'text', ph: 'Jobs, Economy'}],
                prompt: (d, l) => `Recommend 3 modern, high-performance Spigot/Paper plugins for category: ${d.cat}. Avoid dead projects. List Links.`
            },
            {
                id: 'skin', title: 'Skin & Name', descKey: 't_skin', type: 'ai', version: 'All',
                icon: '<path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>',
                inputs: [{id: 'theme', label: 'Titel', type: 'text', ph: 'Futuristischer Ninja'}],
                prompt: (d, l) => `Generate 5 creative, available-sounding Minecraft Usernames for theme: ${d.theme}. Describe a matching skin.`
            },
            {
                id: 'log', title: 'Log Detector', descKey: 't_log', type: 'ai', beta: true, version: 'All',
                icon: '<path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1-.45-1-1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>',
                inputs: [{id: 'log', label: 'Log Paste', type: 'textarea', ph: 'java.lang.NullPointerException...'}],
                prompt: (d, l) => `Analyze this Server Log Stacktrace. Identify the plugin causing it and the likely reason. Log snippet: ${d.log}`
            },
            {
                id: 'armor', title: 'Armor Stand 2.0', descKey: 't_armor', type: 'ai', beta: true, version: '1.20+',
                icon: '<path d="M12 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm1 19h-2v-6h2v6zm-6-8v2h4v-2H7zm10 0h4v2h-4v-2z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'head', label: 'Head (player:Name)', type: 'text', ph: 'MHF_Villager'},
                    {id: 'h', label: 'Main Hand', type: 'text', ph: 'diamond_sword'}, {id: 'off', label: 'Off Hand', type: 'text', ph: 'shield'},
                    {id: 'flags', label: 'Flags', type: 'checks', opts: ['Small', 'Invisible', 'NoBase', 'ShowArms']}
                ],
                prompt: (d, l) => `Summon ArmorStand command (Version ${d.ver}). Equipment: Head player '${d.head}', Hand '${d.h}', Offhand '${d.off}'. Flags: ${d.flags}. If 1.20.5+, use 'entity_data' components. If 1.20.4-, use NBT.`
            },
            {
                id: 'jar', title: 'Plugin Compiler', descKey: 't_jar', type: 'ai', locked: true, hasComingSoon: true, version: 'Java',
                inputs: [], prompt: () => ''
            },
            {
                id: 'cmd', title: 'Command Gen', descKey: 't_cmd', type: 'ai', beta: true, version: '1.21',
                icon: '<path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/>',
                inputs: [
                    {id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS},
                    {id: 'cmd', label: 'Befehl Wunsch', type: 'text', ph: 'Ein Schwert mit Stärke 3'}
                ],
                // VERBESSERTER PROMPT: Erzwingt die korrekte Verwendung des /execute Befehls mit Subcommands
                prompt: (d, l) => `Act as the MCdigger Command Expert. Generate the most robust, functional command for the request: "${d.cmd}" (Version ${d.ver}). If the request requires changing executor, location, or adding conditions (e.g., targeting multiple entities, executing conditionally, running at a block), the command MUST start with the **/execute** command, correctly chaining subcommands (like 'as', 'at', 'if', 'run') according to Java Edition syntax. The output must also utilize advanced item data features like Attribute Modifiers, Custom Model Data, Components/NBT, and correct JSON text, ensuring maximum functionality for the specified version. Always apply the hardcap (e.g., 255 for enchantments) if the requested value is excessive. Explain briefly why the generated command works and if any values were capped.`
            },
            {
                id: 'menu', title: 'Menu Generator', descKey: 't_menu', type: 'ai', version: 'Plugins',
                icon: '<path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'pl', label: 'Plugin', type: 'select', opts: ['DeluxeMenus', 'ZMenu']}, {id: 'desc', label: 'Menu Desc', type: 'text', ph: 'Server selector'}],
                prompt: (d, l) => `Create a configuration snippet for ${d.pl}. Description of menu: ${d.desc}. Include 3 example items with actions.`
            },
            {
                id: 'grad', title: 'Gradient Text', descKey: 't_grad', type: 'ai', version: '1.16+',
                icon: '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>',
                inputs: [{id: 'ver', label: 'MC Version', type: 'select', opts: FULL_VERSIONS}, {id: 'txt', label: 'Text', type: 'text', ph: 'MCdigger'}, {id: 'cols', label: 'Colors', type: 'gradient_builder'}],
                // VERBESSERT: Explizite Anweisung für Hex-Verwendung
                prompt: (d, l) => `Generate a Hex Gradient text for: "${d.txt}" using these colors: ${d.cols}. Ensure smooth transitions using multiple hex color steps between the provided colors. Output both the raw color codes (&#...) and a /tellraw example.`
            }
        ];

        const app = {
            state: {
                lang: 'de',
                currentTool: null,
                currentVersion: '1.21.8' // Auf neueste Version aus der Liste aktualisiert
            },

            init: function() {
                this.renderGrid();
                this.updateTexts();
            },

            renderGrid: function() {
                const grid = document.getElementById('toolsGrid');
                grid.innerHTML = TOOLS.map(tool => `
                    <div class="card ${tool.locked ? 'locked' : ''}" onclick="${tool.locked ? '' : `app.openTool('${tool.id}')`}">
                        <div class="card-icon"><svg viewBox="0 0 24 24">${tool.icon}</svg></div>
                        <div class="badges">
                            ${tool.beta ? '<span class="badge b-beta">BETA</span>' : ''}
                            ${tool.hasComingSoon ? '<span class="badge b-soon">SOON</span>' : ''}
                        </div>
                        <div>
                            <h3>${tool.title}</h3>
                            <p data-key="${tool.descKey}">${TRANSLATIONS.de[tool.descKey]}</p>
                        </div>
                        ${tool.version ? `<span class="version-tag">${tool.version}</span>` : ''}
                    </div>
                `).join('');
            },

            openTool: function(id) {
                const tool = TOOLS.find(t => t.id === id);
                this.state.currentTool = tool;
                
                const sidebar = document.getElementById('toolSidebar');
                let html = '';
                tool.inputs.forEach(i => {
                    html += `<label>${i.label}</label>`;
                    if(i.type === 'select') {
                        // Bei der MC Version die letzte gewählte Version vorwählen
                        
                        html += `<select id="inp_${i.id}" class="sel" onchange="${i.id === 'ver' ? `app.state.currentVersion = this.value` : ''}">`;
                        i.opts.forEach(o => {
                            // Wählt die letzte/Standardversion vor, wenn es das Versionsfeld ist
                            const isSelected = (i.id === 'ver' && o === this.state.currentVersion);
                            html += `<option value="${o}" ${isSelected ? 'selected' : ''}>${o}</option>`;
                        });
                        html += `</select><br>`;
                    } else if (i.type === 'textarea') {
                        html += `<textarea id="inp_${i.id}" class="txt-area" placeholder="${i.ph || ''}"></textarea><br>`;
                    } else if (i.type === 'checks') {
                        html += `<div class="chk-group">`;
                        i.opts.forEach(o => {
                            // Verwende die korrekte Übersetzung für das Label
                            const key = i.id === 'invul' ? 'invul' : `fmt_${o.toLowerCase().replace(/[^a-z]/g, '')}`; // Spezieller Key für Invulnerable
                            const labelText = TRANSLATIONS[this.state.lang][key] || o;
                            html += `<label class="chk-label"><input type="checkbox" id="chk_${i.id}_${o}"> ${labelText}</label>`;
                        });
                        html += `</div><br>`;
                    } else if (i.type === 'gradient_builder') {
                        // Gradient Builder UI
                        html += `<div class="grad-list" id="grad_${i.id}"></div>
                        <button class="btn-sec" onclick="app.addGradColor('${i.id}')">+ Farbe</button><br><br>`;
                        // Fügt Startfarben hinzu
                        setTimeout(() => { 
                            // Entfernt zuerst alle, falls vorhanden
                            document.getElementById(`grad_${i.id}`).innerHTML = '';
                            app.addGradColor(i.id, '#dc2626'); 
                            app.addGradColor(i.id, '#ffffff'); 
                        }, 50);
                    } else {
                        html += `<input type="text" id="inp_${i.id}" class="inp" placeholder="${i.ph || ''}"><br>`;
                    }
                });
                
                const btnText = tool.type === 'local' ? TRANSLATIONS[this.state.lang].calc_btn : TRANSLATIONS[this.state.lang].gen_btn;
                
                if (tool.locked) {
                    html += `<button class="btn-full btn-disabled">COMING SOON</button>`;
                } else {
                    html += `<button class="btn-full" onclick="app.generate()">${btnText}</button>`;
                }

                sidebar.innerHTML = html;

                document.getElementById('toolIconHeader').innerHTML = `<svg viewBox="0 0 24 24">${tool.icon}</svg>`;
                document.getElementById('toolTitleHeader').innerText = tool.title;
                document.getElementById('toolOutput').innerText = "Warte auf Eingabe...";

                document.getElementById('view-home').classList.remove('active');
                document.getElementById('view-tool').classList.add('active');
                document.getElementById('backBtn').style.display = 'flex';
            },

            addGradColor: function(id, initialColor = '#ffffff') {
                const list = document.getElementById(`grad_${id}`);
                if(!list) return;
                const div = document.createElement('div');
                div.className = 'grad-row';
                div.innerHTML = `
                    <input type="color" class="color-preview" value="${initialColor}" oninput="this.nextElementSibling.value=this.value">
                    <input type="text" class="inp" value="${initialColor}" oninput="this.previousElementSibling.value=this.value">
                    <span class="btn-del" onclick="app.removeGradColor(this)">✕</span>
                `;
                list.appendChild(div);
            },

            removeGradColor: function(btn) {
                // Nur entfernen, wenn mehr als zwei Farben vorhanden sind
                if (document.querySelectorAll('.grad-row').length > 2) {
                    btn.parentElement.remove();
                }
            },

            home: function() {
                document.getElementById('view-tool').classList.remove('active');
                document.getElementById('view-home').classList.add('active');
                document.getElementById('backBtn').style.display = 'none';
                this.state.currentTool = null;
            },

            generate: async function() {
                if(!this.state.currentTool) return;
                const tool = this.state.currentTool;
                const data = {};
                
                // Datensammlung
                tool.inputs.forEach(i => {
                    if(i.type === 'checks') {
                        // Sammelt die Optionen (Originalwerte)
                        const selectedOptions = i.opts.filter(o => document.getElementById(`chk_${i.id}_${o}`).checked);
                        data[i.id] = selectedOptions.join(', ');
                    } else if (i.type === 'gradient_builder') {
                        const colors = [];
                        document.querySelectorAll(`#grad_${i.id} input[type=text]`).forEach(e => colors.push(e.value));
                        data[i.id] = colors.join(', ');
                    } else {
                        const el = document.getElementById(`inp_${i.id}`);
                        if(el) data[i.id] = el.value;
                    }
                });

                const output = document.getElementById('toolOutput');
                
                if (tool.type === 'local') {
                    const res = this.runLocal(tool.id, data);
                    output.innerHTML = `<pre><code>${res}</code><div class="copy-btn" onclick="app.copyText(this)">COPY</div></pre>`;
                    this.addCopyButtons();
                } else {
                    const version = data.ver || this.state.currentVersion;
                    this.startLoadingSequence(output, version);
                    
                    // NEU: Setzt die Klasse für den Ladezustand (Scroll-Sperre & Zentrierung)
                    output.classList.add('loading');
                    
                    try {
                        const prompt = tool.prompt(data, this.state.lang);
                        // Verstärkte Systemanweisung, um die Präzision zu erzwingen
                        const system = "You are an expert Minecraft Admin/Developer who specializes in Data Packs. When generating a Data Pack structure, always provide all necessary files (pack.mcmeta and JSONs) in separate, clearly labeled code blocks. The output must be 100% functional and precise according to official documentation. 1.20.5+ uses 'Components'. 1.20.4- uses 'NBT'. Output only clean Markdown. No unnecessary talking. Use the rule: " + getLangInstruction(this.state.lang);
                        
                        const res = await this.callGemini(system + "\n" + prompt);
                        
                        // Setze den Zustand zurück
                        output.classList.remove('loading');
                        output.style.padding = "24px"; // Standard Padding für Tool Output
                        
                        output.innerHTML = this.renderMarkdown(res);
                        this.addCopyButtons();
                    } catch(e) {
                        // Setze den Zustand zurück
                        output.classList.remove('loading');
                        output.style.padding = "24px";
                        
                        output.innerHTML = `<div style="color:#ef4444; background:#330000; padding:15px; border-radius:6px; border:1px solid #7f1d1d;">
                            <strong>ERROR:</strong> ${e.message}<br>
                        </div>`;
                    }
                }
            },

            // NEUE FUNKTION: Startet die gestaffelte Ladeanzeige
            startLoadingSequence: function(el, version) {
                const t = TRANSLATIONS[this.state.lang];
                const steps = [
                    { id: 'step1', text: t.step1, delay: 0 },
                    { id: 'step2', text: t.step2, delay: 500 },
                    { id: 'step3', text: t.step3.replace('{ver}', version || 'aktuell'), delay: 1000 }
                ];

                const loadingHtml = `
                    <div style="
                        display: flex; 
                        flex-direction: column; 
                        align-items: center; 
                        justify-content: center; 
                        height: 100%; 
                        width: 100%;
                    ">
                        <div class="loading-container">
                            <p style="color:var(--accent); font-weight:bold; margin-bottom:15px;">${t.loading}</p>
                            ${steps.map(s => `
                                <div class="loading-step" id="${s.id}">
                                    <div class="loading-icon"></div>
                                    <span>${s.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                el.innerHTML = loadingHtml;

                // Führt die Animation synchron mit dem KI-Aufruf aus (simulierte Wartezeit)
                steps.forEach((step, index) => {
                    setTimeout(() => {
                        const currentEl = document.getElementById(step.id);
                        if (!currentEl) return; 

                        // Deaktiviere vorherigen Schritt (ohne Haken)
                        if (index > 0) {
                            const prevEl = document.getElementById(steps[index - 1].id);
                            if(prevEl) {
                                prevEl.classList.remove('active');
                                prevEl.querySelector('.loading-icon').innerHTML = ''; // Icon entfernt
                            }
                        }
                        
                        // Aktiviere aktuellen Schritt
                        currentEl.classList.add('active');
                        currentEl.querySelector('.loading-icon').innerHTML = `<div class="loading-pulse"></div>`;

                    }, step.delay);
                });
            },

            runLocal: function(id, d) {
                if(id === 'head') {
                    // Head Generator Logik
                    const ver = d.ver || '1.21.8';
                    // Überprüft, ob es sich um Component-Versionen (1.20.5+) handelt.
                    const isComp = ver.startsWith('1.21') || ver.startsWith('1.20.5') || ver.startsWith('1.20.6'); 

                    if (!d.name.trim() || !d.target.trim()) return "Fehler: Name und Target (z.B. @p) sind erforderlich.";
                    const skullOwnerTag = isComp ? `[minecraft:profile={name:"${d.name}"}]` : `{SkullOwner:"${d.name}"}`;
                    return `/give ${d.target} minecraft:player_head${skullOwnerTag} 1`;
                }
                if(id === 'nether') {
                    // Nether Rechner Logik
                    const x = parseFloat(d.x) || 0;
                    const z = parseFloat(d.z) || 0;
                    if (isNaN(x) || isNaN(z)) return "Fehler: X- und Z-Werte müssen Zahlen sein.";

                    if (d.mode.includes('Overworld')) {
                        return `Nether-Koordinaten:\nX=${Math.round(x/8)}\nZ=${Math.round(z/8)}`;
                    } else {
                        return `Overworld-Koordinaten:\nX=${x*8}\nZ=${z*8}`;
                    }
                }
                if(id === 'stack') {
                    // Stack Rechner Logik
                    const total = parseInt(d.amt) || 0;
                    const size = parseInt(d.size) || 64;
                    if (isNaN(total) || isNaN(size) || size <= 0 || total < 0) return "Fehler: Ungültige Item- oder Stack-Anzahl.";

                    const itemsPerShulker = size * 27;
                    const sb = Math.floor(total / itemsPerShulker);
                    const remItems = total % itemsPerShulker;
                    const stacks = Math.floor(remItems / size);
                    const items = remItems % size;
                    
                    return `Items: ${total}\n----------------\nShulker Boxen: ${sb}\nStacks: ${stacks}\nEinzelne Items: ${items}`;
                }
                return "Tool not found.";
            },

            askMain: async function() {
                const inp = document.getElementById('mainAiPrompt');
                const out = document.getElementById('mainAiRes');
                const val = inp.value.trim();
                if(!val) return;

                out.style.display = 'block';
                this.startLoadingSequence(out, 'aktuell'); // Verwende 'aktuell' als Platzhalter für die Haupt-KI

                // NEU: Setzt die Klasse für den Ladezustand (Scroll-Sperre & Zentrierung)
                out.classList.add('loading');
                
                const sys = "You are MCdigger AI. Expert in Minecraft Java Edition. Be precise.";
                const langRule = getLangInstruction(this.state.lang);
                
                try {
                    const res = await this.callGemini(`${sys}\nRule: ${langRule}\nUser: ${val}`);
                    
                    // Setze den Zustand zurück
                    out.classList.remove('loading');
                    out.style.padding = "16px"; // Standard Padding für AI Box Output
                    
                    out.innerHTML = this.renderMarkdown(res);
                    this.addCopyButtons();
                } catch(e) {
                    // Setze den Zustand zurück
                    out.classList.remove('loading');
                    out.style.padding = "16px";
                    
                    out.innerHTML = `<div style="color:#ef4444; background:#330000; padding:15px; border-radius:6px; border:1px solid #7f1d1d;">
                        <strong>ERROR:</strong> ${e.message}<br>
                    </div>`;
                }
            },

            showLoading: function(el) {
                // Diese Funktion wird nur noch als Fallback verwendet.
                el.innerHTML = `
                    <div style="display:flex; align-items:center; padding:20px; color:var(--accent);">
                        <div class="loading-pulse"></div>
                        <div class="loading-pulse" style="animation-delay:0.2s"></div>
                        <div class="loading-pulse" style="animation-delay:0.4s"></div>
                        <span style="margin-left:10px; color:var(--text-dim);">${TRANSLATIONS[this.state.lang].loading}</span>
                    </div>
                `;
            },

            // --- KI CALL FUNKTION ---
            callGemini: async function(text) {
                // Verwende das neuere, stabilere Modell
                const model = 'gemini-2.5-flash'; 
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${CONFIG.apiKey}`;
                
                console.log("Sende Anfrage an:", url); 

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("API Error Details:", errorText);

                        if(response.status === 404) throw new Error("Fehler 404: Modell nicht gefunden oder API im Google Cloud Projekt nicht aktiviert.");
                        if(response.status === 403) throw new Error("Fehler 403: API Key ungültig oder keine Berechtigung.");
                        
                        throw new Error(`API Error ${response.status}: ${response.statusText}`); 
                    }

                    const data = await response.json();
                    if (data.candidates && data.candidates.length > 0) {
                        return data.candidates[0].content.parts[0].text;
                    } else if (data.promptFeedback && data.promptFeedback.blockReason) {
                        throw new Error(`Anfrage blockiert: ${data.promptFeedback.blockReason}`);
                    } else {
                        throw new Error("Keine Antwort von der KI erhalten.");
                    }
                } catch (error) {
                    console.error(error);
                    throw error; 
                }
            },

            renderMarkdown: function(text) {
                if(typeof marked !== 'undefined') return marked.parse(text);
                return text;
            },

            addCopyButtons: function() {
                setTimeout(() => {
                    document.querySelectorAll('pre').forEach(pre => {
                        if(pre.querySelector('.copy-btn')) return;
                        const btn = document.createElement('div');
                        btn.className = 'copy-btn';
                        btn.innerText = 'COPY';
                        btn.onclick = function() { app.copyText(this); };
                        pre.appendChild(btn);
                    });
                }, 100);
            },

            copyText: function(btn) {
                const code = btn.parentElement.querySelector('code') || btn.parentElement;
                // Entfernt den "COPY" Text vor dem Kopieren
                const text = code.innerText.replace(new RegExp(`\\s*${btn.innerText}$`), '');
                navigator.clipboard.writeText(text).then(() => {
                    const orig = btn.innerText;
                    btn.innerText = "COPIED!";
                    btn.style.color = "var(--success)";
                    setTimeout(() => { btn.innerText = orig; btn.style.color = ""; }, 2000);
                });
            },

            toggleLang: function() {
                this.state.lang = this.state.lang === 'de' ? 'en' : 'de';
                document.getElementById('langIcon').innerText = this.state.lang.toUpperCase();
                this.updateTexts();
            },

            toggleTheme: function() {
                document.documentElement.classList.toggle('light');
            },

            updateTexts: function() {
                const t = TRANSLATIONS[this.state.lang];
                document.getElementById('lblBack').innerText = t.back;
                document.getElementById('mainAiPrompt').placeholder = t.ph_ai;
                TOOLS.forEach(tool => {
                    const el = document.querySelector(`p[data-key="${tool.descKey}"]`);
                    if(el) el.innerText = t[tool.descKey];
                });
                const btn = document.querySelector('.btn-full');
                if(btn && !btn.classList.contains('btn-disabled')) {
                    const tool = this.state.currentTool;
                    btn.innerText = tool && tool.type === 'local' ? t.calc_btn : t.gen_btn;
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            app.init();
        });
    </script>
</body>
</html>